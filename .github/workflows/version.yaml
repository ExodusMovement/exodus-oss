name: Version
on:
  workflow_dispatch:
    inputs:
      packages:
        description: 'Selected packages as comma separated string, e.g. modules/storage-spec,libraries/formatting'
        type: string
        required: true
      version-strategy:
        type: choice
        options:
          - conventional-commits
          - patch
          - minor
          - major
          - prerelease
          - prepatch
          - preminor
          - premajor
        default: 'conventional-commits'
      assignee:
        description: 'Overrides the default assignee, which is the user to trigger this workflow.'
        type: string
        required: false

jobs:
  version:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - uses: ExodusMovement/actions/setup/lerna@65b395a82884455e8dc0cbc32355d8864f1ec30c
        with:
          npm-token: ${{ secrets.NPM_TOKEN }}
      - name: Install dependencies
        run: yarn install --immutable
      - name: Prepare
        run: yarn prepare
      - name: Import GPG key
        id: import-gpg
        uses: crazy-max/ghaction-import-gpg@1a317071222a9bfb1839df1b58b1f0dcd893b589
        with:
          gpg_private_key: ${{ secrets.GPG_PRIVATE_KEY }}
          passphrase: ${{ secrets.GPG_PASSPHRASE }}
          git_config_global: true
          git_user_signingkey: true
          git_commit_gpgsign: true
      - name: Version
        uses: ExodusMovement/lerna-release-action/version@931392d04a637dccb561398add594a6cf61255b8
        with:
          github-token: ${{ secrets.GH_AUTOMATION_PAT }}
          packages: ${{ inputs.packages }}
          assignee: ${{ inputs.assignee }}
          committer: exodus-github-hydra-bot
          version-strategy: ${{ inputs.version-strategy }}
          auto-merge: true
